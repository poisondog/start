cmake_minimum_required(VERSION 2.8.12)

project (${PROJECT_NAME} CXX C)

set(CMAKE_SYSTEM_NAME Linux)
set(CMAKE_C_COMPILER "$ENV{COMMAND_C}")
set(CMAKE_CXX_COMPILER "$ENV{COMMAND_CXX}")

set(LIBRARY_NAME_X64_STATIC "${LIBRARY_NAME}-x64-static")
set(LIBRARY_NAME_X64_SHARE "${LIBRARY_NAME}-x64-share")
include_directories(${LIBRARY_HEADER_FOLDER} ${LIBRARY_CLASS_FOLDER} ${REFERENCE_INCLUDE})

#create library file
add_library(${LIBRARY_NAME_X64_STATIC} STATIC ${LIBRARY_CLASS_FILES} ${LIBRARY_HEADER_FILES})
add_library(${LIBRARY_NAME_X64_SHARE} SHARED ${LIBRARY_CLASS_FILES} ${LIBRARY_HEADER_FILES})

set_target_properties(${LIBRARY_NAME_X64_STATIC} PROPERTIES LINKER_LANGUAGE CXX)
set_target_properties(${LIBRARY_NAME_X64_SHARE} PROPERTIES LINKER_LANGUAGE CXX)
set_target_properties(${LIBRARY_NAME_X64_STATIC} PROPERTIES OUTPUT_NAME ${LIBRARY_NAME})
set_target_properties(${LIBRARY_NAME_X64_SHARE} PROPERTIES OUTPUT_NAME ${LIBRARY_NAME})
set_target_properties(${LIBRARY_NAME_X64_STATIC} PROPERTIES CLEAN_DIRECT_OUTPUT 1)
set_target_properties(${LIBRARY_NAME_X64_SHARE} PROPERTIES CLEAN_DIRECT_OUTPUT 1)
set_target_properties(${LIBRARY_NAME_X64_STATIC} PROPERTIES VERSION ${VERSION})
set_target_properties(${LIBRARY_NAME_X64_SHARE} PROPERTIES VERSION ${VERSION})

#create executable file
add_executable(${PROJECT_NAME} ${MAIN_CLASS_FILES})
target_link_libraries(${PROJECT_NAME} ${LIBRARY_NAME_X64_STATIC} ${REFERENCE_X64_LIBRARY})

#install(TARGETS ${PROJECT_NAME} RUNTIME DESTINATION bin)
#install(TARGETS ${LIBRARY_NAME_X64_STATIC} ${LIBRARY_NAME_X64_SHARE} LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
#install(FILES ${LIBRARY_HEADER_FILES} DESTINATION include/${LIBRARY_NAME})

#test with google test
enable_testing()
find_package(GTest REQUIRED)
find_package (Threads REQUIRED)
include_directories(${GTEST_INCLUDE_DIR})
add_executable(runTest ${TEST_CLASS_FILES} ${LIBRARY_CLASS_FILES})
target_link_libraries(runTest ${GTEST_BOTH_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT} ${LIBRARY_NAME_X64_STATIC} ${REFERENCE_X64_LIBRARY})
add_test(AllTests runTest)
